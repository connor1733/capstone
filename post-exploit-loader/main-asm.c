#include <sys/syscall.h>
#include <sys/types.h>          /* See NOTES */
#include <sys/socket.h>
#include <stdio.h>

#define PORT "31d4"
#define IP(a,b,c,d) #d#c#b#a

int main(){ 

  __asm(
      "sub sp, sp, 32;"
      // AF_INET
      "mov x0, 2;"
      // SOCK_STREAM
      "mov x1, 1;"
      // protocol
      "mov x2, 0;"
      // __NR_SOCKET = 198
      "mov x8, 198;"
      // SYSCALL
      "svc 0;"
      // save socket fd in x9 for later
      "mov x9, x0;"
      
      // ip 127.0.0.1 port 54321 family AF_INET
      "ldr x1, =0x"IP(7f,00,00,01)";"
      "lsl x1, x1, 32;"

      "ldr x2, =0x"PORT"0002;"
      "add x1, x1, x2;"
      
      "mov x2, 0;"

      "str x1, [sp];"
      "str x2, [sp, 8];"
      
      "mov x8, 203;"
      "add x1, sp, 0;"
      "mov x2, 16;"
      "svc 0;"

      "ldr w0, =0x70717070;"
      "str w0, [sp];"

      "mov w0, 0;"
      "str w0, [sp, 4];"

      "ldr x0, =0xffffff9c;"
      "add x1, sp, 0;"
      "mov x2, 578;"
      "mov x3, 511;"
      "mov x8, 56;"
      "svc 0;"

      "ret;"
  );


}
