#include <sys/syscall.h>
#include <sys/types.h>          /* See NOTES */
#include <sys/socket.h>
#include <stdio.h>

#define PORT "0000"
#define IP(a,b,c,d) #a#b#c#d

int main(){ 

  int x = 0;
  char *p = (char *) &x;

  __asm(
      // AF_INET
      "sub sp, sp, 32;"
      "mov x0, 2;"
      // SOCK_STREAM
      "mov x1, 1;"
      // protocol
      "mov x2, 0;"
      // __NR_SOCKET = 41
      "mov x8, 41;"
      // SYSCALL
      "svc 0;"
      // save socket fd in x9 for later
      "mov x9, x0;"
      "nop;nop;nop;nop;"
      
      //0200 0123 fffefefb 0000000000000000
      // ip 127.0.0.1 port 54321 family AF_INET
      "ldr x1, =0x0200"PORT";"
      "lsl x1, x1, 32;"
      "ldr x2, =0x"IP(7f,00,00,01)";"
      "add x1, x1, x2;"
      "eor x2, x2, x2;"
      "str x1, [sp];"
      "str x2, [sp, 8];"
  );

  for(int i=0;i<100;i++){
    printf("Address %p, value %02x\n", p+i, *(p+i));
  }

  return 0;
}
